# Configuração do Argos Agent para Docker
# Este agente monitora sistemas externos através da rede 'external-monitoring'

agent_id: argos-docker-agent
push_endpoint: http://api:8082/ingest
push_interval: 15s

targets:
  # Monitora a API-EXEMPLO através do Nginx
  http:
    - name: api-exemplo-web
      url: http://api-nginx/
      method: GET
      timeout: 5s

    - name: api-exemplo-health
      url: http://api-nginx/health
      method: GET
      timeout: 5s

    - name: api-exemplo-users
      url: http://api-nginx/users
      method: GET
      timeout: 5s

    # Monitora também o próprio Argos
    - name: argos-api-health
      url: http://api:8082/health
      method: GET
      timeout: 5s

  # Monitora o banco da API-EXEMPLO
  postgres:
    - name: api-database
      dsn: postgres://apiuser:apipass@api-database:5432/apidb?sslmode=disable
      timeout: 5s

    # Monitora o banco do Argos
    - name: argos-database
      dsn: postgres://argos:argos123@postgres:5432/argos?sslmode=disable
      timeout: 5s

  # Monitora resolução DNS
  dns:
    - name: google-dns
      fqdn: google.com
      server: 8.8.8.8:53

    - name: cloudflare-dns
      fqdn: cloudflare.com
      server: 1.1.1.1:53

  # Monitora SMTP do MailHog
  smtp:
    - name: mailhog-smtp
      host: argos-mailhog
      port: 1025
      timeout: 5s

  # Monitora conectividade ICMP
  icmp:
    - name: api-example-ping
      host: api-example
      timeout: 3s

    - name: api-database-ping
      host: api-database
      timeout: 3s

    - name: api-nginx-ping
      host: api-nginx
      timeout: 3s
